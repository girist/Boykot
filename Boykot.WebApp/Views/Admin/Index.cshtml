@{
    ViewData["Title"] = "Yonetim - Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="text-center">

    <div class="container-fluid">
        <div class="row">
            <div class="col-8">
                <input id="txtsearchkey" type="text" class="form-control" />
            </div>
            <div class="col-4">
                <select name="criteria" id="criteria" class="form-control">
                    <option value="Urun">Urun</option>
                    @*@foreach (var item in Enum.GetValues(typeof(Boykot.WebApp.Enums.SearchCriteriaEnum)))
                    {
                        <option value="@item.ToString()">@item.ToString()</option>
                    }*@
                </select>
            </div>
        </div>

    </div>
    <br />
    <br />
    <table id="tblProducts" class="table">
        <tr>
            <th style="width: 90px">Adi</th>
            <th style="width: 120px">Marka</th>
            <th style="width: 90px">Kod</th>
            <th style="width: 90px">Barkod</th>
            <th style="width: 90px">Ülke</th>
            <th style="width: 90px">Sil</th>
            <th style="width: 90px">Güncelle</th>
        </tr>
    </table>
    <!--#region select data  -->
    <script type="text/javascript">
        $(function () {
            $("#txtsearchkey").keyup(function () {
                if ($(this).val().length < 3)
                    return;
                GetProducts();
            });
        });
        function GetProducts() {
            let formData = {
                SearchText: $("#txtsearchkey").val(),
                Criteria: $('#criteria option:selected').text(),
            }
            console.log(formData)
            $.ajax({
                type: "POST",
                url: "/Home/SearchProducts",
                dataType: 'json',
                data: formData,
                success: function (products) {
                    var table = $("#tblProducts");
                    console.log(products);
                    table.find("tr:not(:first)").remove();
                    $.each(products, function (i, products) {
                        var table = $("#tblProducts");
                        var row = table[0].insertRow(-1);
                        $(row).append("<td />");
                        $(row).find("td").eq(0).html(products.adi);
                        $(row).append("<td />");
                        $(row).find("td").eq(1).html(products.marka);
                        $(row).append("<td />");
                        $(row).find("td").eq(2).html(products.kodu);
                        $(row).append("<td />");
                        $(row).find("td").eq(3).html(products.barkod);
                        $(row).append("<td />");
                        $(row).find("td").eq(4).html(products.ulke);
                        $(row).append("<td />");
                        $(row).find("td").eq(5).html("<input type='button' value='Sil' onclick='DeleteOdemeSeti(" + products.id + ")'/>");
                        $(row).append("<td />");
                        $(row).find("td").eq(6).html("<a href='Admin/CreateOrUpdate?id=" + products.id + "'>Güncelle</a>");
                    });
                }
            });
        }
        //product delete func
        function DeleteOdemeSeti(id) {
            let result = confirm("Silmek istediğinizden Emin Misiniz?");
            let formData = {
                id: id,
            }
            console.log(formData)
            if (result) {
                $.ajax({
                    type: "POST",
                    url: "/Admin/Delete",
                    dataType: 'json',
                    data: formData,
                    success: function (response) {
                        alert("İslem Basarili");
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        location.reload();
                    }
                });
            } else {
                alert("İşlemde İptal Edildi");
            }
        }
    </script>
    <!--#endregion -->
   
</div>


